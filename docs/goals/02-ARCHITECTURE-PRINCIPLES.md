# 02 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏ ADR

> –í–ª–∞–¥–µ–ª–µ—Ü: Architect
> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2026-02-24

---

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### P1. Python –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏, Rust –¥–ª—è performance-critical paths

- **Python** ‚Äî API, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, AI orchestration, Learning Engine, admin, ML pipelines
- **Rust** ‚Äî –ø–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ, real-time messaging, CDN edge logic (Phase 4)
- **–†–µ—à–µ–Ω–∏–µ –æ —è–∑—ã–∫–µ:** p99 < 50ms –∏–ª–∏ > 10K RPS ‚Üí Rust. –û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Üí Python

### P2. –ú–æ–Ω–æ—Ä–µ–ø–∞ —Å —á–µ—Ç–∫–∏–º–∏ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏

- –ï–¥–∏–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –Ω–æ —Å—Ç—Ä–æ–≥–∏–µ boundaries –º–µ–∂–¥—É –¥–æ–º–µ–Ω–∞–º–∏
- Shared –ø—Ä–æ—Ç–æ–∫–æ–ª—ã —á–µ—Ä–µ–∑ protobuf/flatbuffers
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π –¥–µ–ø–ª–æ–π –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

### P3. Event-Driven –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

- –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ bounded context
- –ú–µ–∂–¥—É –¥–æ–º–µ–Ω–∞–º–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è
- Event Store –∫–∞–∫ source of truth –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤

### P4. Design for 10x, build for 1x

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–¥–µ—Ä–∂–∞—Ç—å 10x –æ—Ç —Ç–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è
- –ù–æ —Ä–µ–∞–ª–∏–∑—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–µ–π—á–∞—Å
- –ö–∞–∂–¥–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–º–µ–Ω—è–µ–º–æ –∑–∞ 2 –Ω–µ–¥–µ–ª–∏

### P6. Two Contours ‚Äî Content + Learning

- **Content Contour** (—Å—É—â–µ—Å—Ç–≤—É–µ—Ç): Identity, Course, Enrollment, Payment, Notification ‚Äî CRUD, –∫–∞—Ç–∞–ª–æ–≥, –±–∞–∑–æ–≤—ã–π UX
- **Learning Contour** (Phase 2): AI Service, Learning Engine ‚Äî –∫–≤–∏–∑—ã, spaced repetition, knowledge graph, AI-—Ç—å—é—Ç–æ—Ä
- –ö–æ–Ω—Ç—É—Ä—ã —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ events (course.completed ‚Üí trigger flashcard generation)
- Learning Contour –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ Content Contour, –Ω–æ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç

### P5. Observable by default

- –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å ‚Äî –º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏, —Ç—Ä–µ–π—Å—ã —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è
- SLO –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞
- –ê–ª–µ—Ä—Ç—ã –Ω–∞ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—é, –∞ –Ω–µ –Ω–∞ –ø–∞–¥–µ–Ω–∏–µ

---

## Architecture Decision Records (ADR)

### ADR-001: –ú–æ–Ω–æ—Ä–µ–ø–∞ –≤–º–µ—Å—Ç–æ –º—É–ª—å—Ç–∏—Ä–µ–ø–æ

- [X] ‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –ú–æ–Ω–æ—Ä–µ–ø–∞ (Python + Rust + TypeScript –≤ –æ–¥–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)

- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –ù–∞ —Ä–∞–Ω–Ω–µ–π —Å—Ç–∞–¥–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç—å –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≤–∞–∂–Ω–µ–µ –∏–∑–æ–ª—è—Ü–∏–∏. –ú–æ–Ω–æ—Ä–µ–ø–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –≥—Ä–∞–Ω–∏—Ü—ã —Å–µ—Ä–≤–∏—Å–æ–≤
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –ù—É–∂–µ–Ω —Ö–æ—Ä–æ—à–∏–π CI (selective builds), code ownership —á–µ—Ä–µ–∑ CODEOWNERS
- **–ü–µ—Ä–µ—Å–º–æ—Ç—Ä:** –ü—Ä–∏ > 50 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –æ—Ü–µ–Ω–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –º—É–ª—å—Ç–∏—Ä–µ–ø–æ

### ADR-002: Event bus ‚Äî NATS JetStream

- [ ] üî¥ **–†–µ—à–µ–Ω–∏–µ:** NATS JetStream –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–∞—è —à–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π

- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –õ–µ–≥—á–µ Kafka –¥–ª—è —Å—Ç–∞—Ä—Ç–∞, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç persistence, exactly-once semantics. Rust SDK –∑—Ä–µ–ª—ã–π
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:** Kafka (—Å–ª–∏—à–∫–æ–º —Ç—è–∂–µ–ª—ã–π –¥–ª—è < 1M), RabbitMQ (–Ω–µ—Ç native persistence), Redis Streams (–Ω–µ–Ω–∞–¥–µ–∂–Ω—ã–π)
- **–ü–µ—Ä–µ—Å–º–æ—Ç—Ä:** –ü—Ä–∏ > 500K events/sec –æ—Ü–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ Kafka

### ADR-003: PostgreSQL –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î, —Å —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ Citus

- [ ] üî¥ **–†–µ—à–µ–Ω–∏–µ:** PostgreSQL + Citus –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** PostgreSQL –ø–æ–∫—Ä—ã–≤–∞–µ—Ç 90% –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π. Citus –ø–æ–∑–≤–æ–ª—è–µ—Ç —à–∞—Ä–¥–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Å–º–µ–Ω—ã –ë–î
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** Redis –¥–ª—è –∫—ç—à–∞, ClickHouse –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, Meilisearch –¥–ª—è –ø–æ–∏—Å–∫–∞

### ADR-004: gRPC –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏, REST –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ API

- [ ] üî¥ **–†–µ—à–µ–Ω–∏–µ:** –í–Ω—É—Ç—Ä–∏ ‚Äî gRPC (protobuf). –ù–∞—Ä—É–∂—É ‚Äî REST (OpenAPI)

- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** gRPC –¥–∞–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏—é, –∫–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é, streaming. REST –ø—Ä–æ—â–µ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### ADR-005: –í–∏–¥–µ–æ-–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ ‚Äî Rust —Å–µ—Ä–≤–∏—Å —Å FFmpeg bindings

- [ ] üî¥ **–†–µ—à–µ–Ω–∏–µ:** –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –Ω–∞ Rust –¥–ª—è —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞

- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –í–∏–¥–µ–æ ‚Äî –∫–ª—é—á–µ–≤–æ–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ç–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç SaaS (Mux, Cloudflare Stream) ‚Äî —Ä–∏—Å–∫ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ 10M users
- **–ü–µ—Ä–µ—Å–º–æ—Ç—Ä:** –î–æ 100K users –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Cloudflare Stream, –ø–æ—Ç–æ–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å

### ADR-006: Feature flags —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è

- [ ] üî¥ **–†–µ—à–µ–Ω–∏–µ:** –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ feature flags (–ø—Ä–æ—Å—Ç–∞—è) –∏–ª–∏ Unleash

- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** Canary releases, A/B —Ç–µ—Å—Ç—ã, kill switches ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –ø—Ä–∏ 10M users

### ADR-007: FSRS –¥–ª—è spaced repetition (Phase 2)

- [ ] üîµ **–†–µ—à–µ–Ω–∏–µ:** FSRS (Free Spaced Repetition Scheduler) –≤–º–µ—Å—Ç–æ SM-2

- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** FSRS ‚Äî academically validated, open source (py-fsrs), ~4 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –Ω–∞ —É—á–µ–Ω–∏–∫–∞. –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç SM-2 –ø–æ retention accuracy. Zero API cost ‚Äî —á–∏—Å—Ç—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:** SM-2 (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π), Leitner (—Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π), custom ML (overengineering)

### ADR-008: Model routing –¥–ª—è AI (Phase 2)

- [ ] üîµ **–†–µ—à–µ–Ω–∏–µ:** Multi-tier LLM routing: 80% –¥–µ—à—ë–≤—ã–µ (Gemini Flash), 15% —Å—Ä–µ–¥–Ω–∏–µ (Claude Haiku), 5% –¥–æ—Ä–æ–≥–∏–µ (Claude Sonnet)

- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** AI-—Å—Ç–æ–∏–º–æ—Å—Ç—å ~$0.03/user/month –ø—Ä–∏ —Ç–∞–∫–æ–º routing. Quiz generation, flashcard extraction ‚Äî –¥–µ—à—ë–≤–∞—è –º–æ–¥–µ–ª—å. Socratic tutor ‚Äî —Å—Ä–µ–¥–Ω—è—è. Complex reasoning ‚Äî –¥–æ—Ä–æ–≥–∞—è
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:** Single model (–¥–æ—Ä–æ–≥–æ), self-hosted SLM (—Ä–∞–Ω–æ, Phase 4)

### ADR-009: pgvector –¥–ª—è embeddings (Phase 2)

- [ ] üîµ **–†–µ—à–µ–Ω–∏–µ:** pgvector extension –¥–ª—è PostgreSQL –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ vector DB

- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º PostgreSQL. pgvector –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –¥–ª—è < 10M embeddings. –ù–µ—Ç –Ω—É–∂–¥—ã –≤ Pinecone/Weaviate/Qdrant –Ω–∞ —Ç–µ–∫—É—â–µ–º –º–∞—Å—à—Ç–∞–±–µ
- **–ü–µ—Ä–µ—Å–º–æ—Ç—Ä:** –ü—Ä–∏ > 10M embeddings –∏–ª–∏ > 100ms vector search ‚Äî –æ—Ü–µ–Ω–∏—Ç—å dedicated vector DB

---

## –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å)

### TODO –¥–ª—è Architect:

- [ ] üî¥ –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å C4 Level 1 (System Context) –¥–∏–∞–≥—Ä–∞–º–º—É
- [ ] üî¥ –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å C4 Level 2 (Container) –¥–∏–∞–≥—Ä–∞–º–º—É
- [ ] üî¥ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å communication patterns –º–µ–∂–¥—É –∫–∞–∂–¥–æ–π –ø–∞—Ä–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] üî¥ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å data ownership ‚Äî –∫–∞–∫–æ–π —Å–µ—Ä–≤–∏—Å –≤–ª–∞–¥–µ–µ—Ç –∫–∞–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- [ ] üî¥ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è API (URL vs header)
- [ ] üî¥ –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å failure modes –∏ circuit breaker —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
- [ ] üî¥ –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (zero-downtime)
- [ ] üî¥ –û–ø–∏—Å–∞—Ç—å contract testing —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
