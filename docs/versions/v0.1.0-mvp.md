# v0.1.0 — MVP (Real MVP)

> **Release date:** 2026-02-22
> **Author:** Solo developer, 1 day sprint
> **Stage:** MVP — до 10K пользователей
> **Branch:** `release/v0.1.0-mvp`

---

## Что это

Первая рабочая версия EduPlatform — онлайн-платформы обучения (аналог Udemy/Coursera lite). Собрана одним разработчиком за 1 день как proof-of-concept с намеренными architectural shortcuts для итеративного масштабирования.

Это **не production-ready** система. Это **instrumented MVP** — рабочий продукт с полным user flow, обвешанный метриками, чтобы data-driven находить bottleneck-и и приоритизировать следующие шаги.

Подробно о видении продукта — [`goals/01-PRODUCT-VISION.md`](../goals/01-PRODUCT-VISION.md).
Текущая архитектура — [`architecture/01-SYSTEM-OVERVIEW.md`](../architecture/01-SYSTEM-OVERVIEW.md).

---

## Что работает (end-to-end)

### Flow 1: Обучение студента
```
Регистрация → Поиск курсов → Просмотр курса → Запись → Оплата →
→ Программа курса → Урок → Завершение урока → Прогресс → Отзыв
```

### Flow 2: Создание контента (teacher)
```
Регистрация (teacher) → Ожидание верификации admin → Создание курса →
→ Добавление модулей → Добавление уроков (markdown + video embed) → Просмотр записей
```

### Flow 3: Администрирование
```
Логин (admin) → Список pending teachers → Верификация → Teacher получает доступ
```

Полный список endpoints — [`architecture/02-API-REFERENCE.md`](../architecture/02-API-REFERENCE.md).
Auth flow и JWT claims — [`architecture/04-AUTH-FLOW.md`](../architecture/04-AUTH-FLOW.md).

---

## Архитектура

### Сервисы (5 Python микросервисов)

| Service | Port | Ответственность | DB | Тесты |
|---------|------|-----------------|-----|-------|
| Identity | 8001 | Auth, регистрация, роли, admin ops | identity-db :5433 | 32 |
| Course | 8002 | CRUD courses/modules/lessons, поиск, отзывы | course-db :5434 | 40 |
| Enrollment | 8003 | Записи на курсы, прогресс по урокам | enrollment-db :5435 | 20 |
| Payment | 8004 | Mock-платежи (всегда "completed") | payment-db :5436 | 11 |
| Notification | 8005 | Уведомления (log to stdout), статус прочтения | notification-db :5437 | 10 |

**Итого: 113 unit-тестов по 5 сервисам.**

Схемы БД — [`architecture/03-DATABASE-SCHEMAS.md`](../architecture/03-DATABASE-SCHEMAS.md).
Shared library — [`architecture/06-SHARED-LIBRARY.md`](../architecture/06-SHARED-LIBRARY.md).

### Frontend (1 приложение)

| App | Port | Stack |
|-----|------|-------|
| Buyer | 3001 | Next.js 15, React 19, Tailwind CSS 4, TypeScript |

Страницы: каталог, поиск, карточка курса, программа, урок, записи, teacher dashboard, admin panel.

### Инфраструктура

| Компонент | Назначение |
|-----------|------------|
| 5x PostgreSQL 16 | Database-per-service |
| Redis 7 | Развёрнут, не используется (намеренно — Phase 1) |
| Prometheus | Сбор метрик (5s interval) |
| Grafana | Dashboards: RPS, latency, errors, DB pool |
| Locust | Нагрузочное тестирование (3 профиля пользователей) |
| Docker Compose | Dev (hot reload) + Prod (multi-worker, monitoring) |

Подробности инфраструктуры — [`architecture/05-INFRASTRUCTURE.md`](../architecture/05-INFRASTRUCTURE.md).

---

## Осознанные решения и trade-offs

### Намеренные (by design)

| Решение | Обоснование |
|---------|-------------|
| `ILIKE '%query%'` без индекса | Намеренный bottleneck. Замерено: avg 426ms при 10 RPS. Оптимизация pg_trgm + GIN — по метрикам. |
| DB connection pool = 5 | Намеренно мало. Замерено: 100% saturation на Course service под нагрузкой. |
| Нет кэширования | Redis развёрнут, но не подключён. Подключим когда DB reads станут bottleneck. |
| Нет API gateway | Прямой доступ к сервисам через Next.js rewrites. Rust gateway — при 100K+ users. |
| Нет event bus | Клиент оркестрирует цепочку (Payment → Enrollment → Notification). NATS — Phase 2. |
| Mock-платежи | Всегда "completed". Реальная интеграция — Phase 2+. |
| Notifications = stdout | Нет email/push. Только in-app запись. Достаточно для MVP. |
| JWT shared secret (HS256) | Все сервисы валидируют JWT самостоятельно. Просто, достаточно для single-cluster. |

Архитектурные принципы — [`goals/02-ARCHITECTURE-PRINCIPLES.md`](../goals/02-ARCHITECTURE-PRINCIPLES.md).

### Shortcuts (tech debt, известный)

| Shortcut | Влияние | Когда чинить |
|----------|---------|-------------|
| Нет CI/CD | Только ручное тестирование | Phase 1 |
| Нет rate limiting | API не защищён от abuse | Phase 1 |
| Нет refresh tokens | Re-login при истечении JWT | Phase 1 |
| Offset pagination | Не масштабируется > 10K результатов | Phase 1 |
| Нет HTTPS | HTTP only, dev-окружение | Phase 1 |
| bcrypt в request path | ~500ms на логин, блокирует worker | Приемлемо для MVP нагрузки |
| Single-region, single-node | Нет HA, нет failover | Phase 2+ |

---

## Baseline-метрики (замерено)

Load test: 100 concurrent users, ramp-up 10/s, 5 минут, ~55 RPS peak.

| Метрика | Значение |
|---------|----------|
| Peak RPS | ~55 |
| Total requests | 16,085 |
| Error rate | 0.5% (80 login failures — проблема тестовых данных) |
| Course search avg | 426ms |
| Course search p99 | 803ms |
| Course list avg | 52ms |
| Curriculum avg | 57ms |
| DB pool saturation (Course) | 100% |
| DB pool saturation (остальные) | 0% |

Полный анализ bottleneck-ов — [`phases/PHASE-0.7-BASELINE.md`](../phases/PHASE-0.7-BASELINE.md).

### Выявленные bottleneck-и

1. **P0 — ILIKE full table scan** на 100K courses. Search p99 = 803ms.
2. **P1 — Pool exhaustion**. Course service: 5/5 connections = 100%.
3. **P2 — Login test failures**. Несовпадение user ID range в Locust и seed data.

---

## Объёмы seed-данных

| Сущность | Объём | Примечания |
|----------|-------|-----------|
| Users | 50,001 | 1 admin + 40K students + 10K teachers |
| Courses | 100,000 | Принадлежат teachers |
| Modules | ~35,000 | 1-5 на курс (первые 10K курсов) |
| Lessons | ~210,000 | 1-10 на модуль, markdown + video URL |
| Enrollments | 200,000 | Пары student-course |
| Payments | 50,000 | Все "completed" |
| Reviews | ~100,000 | Рейтинг 1-5 + текст |

---

## Как запустить

### Development (hot reload)
```bash
docker compose -f docker-compose.dev.yml up --build
```

### Production (monitoring + multi-worker)
```bash
docker compose -f docker-compose.prod.yml up -d --build
docker compose -f docker-compose.prod.yml --profile seed up seed
docker compose -f docker-compose.prod.yml --profile loadtest up -d locust
```

### Тесты
```bash
cd services/py/identity && uv run --package identity pytest tests/ -v
cd services/py/course && uv run --package course pytest tests/ -v
cd services/py/enrollment && uv run --package enrollment pytest tests/ -v
cd services/py/payment && uv run --package payment pytest tests/ -v
cd services/py/notification && uv run --package notification pytest tests/ -v
```

### Точки входа

- Frontend: http://localhost:3001
- Grafana: http://localhost:3000
- Locust: http://localhost:8089
- Prometheus: http://localhost:9090

---

## Что дальше (v0.2.0 — Optimization)

Цель: 500 RPS, p99 < 200ms, 0 errors.

Roadmap оптимизаций — [`goals/00-ROADMAP.md`](../goals/00-ROADMAP.md) (секция "Оптимизация — 10K → 100K").

---

## Честная оценка

**Что получилось хорошо:**
- Полный end-to-end flow: регистрация → обучение → отзыв
- 113 тестов дают базовую safety net
- Monitoring stack (Prometheus + Grafana) даёт visibility с первого дня
- Load testing (Locust) на реалистичных данных находит реальные bottleneck-и
- Clean Architecture сохраняет навигируемость кода несмотря на скорость разработки
- Database-per-service с самого начала избавляет от болезненной миграции потом

**Что сыро:**
- Поиск непригоден под нагрузкой (426ms avg, будет хуже)
- Нет кэширования — каждый page load идёт в БД
- Payment — mock без бизнес-логики
- Notifications — stdout, нет механизма доставки
- Frontend функционален, но не отполирован
- Нет CI — merge в main и надеяться

**Чего не хватает для реальных пользователей:**
- Видеохостинг (сейчас YouTube/Vimeo embeds)
- Email-верификация, сброс пароля
- Категории курсов, фильтрация, сортировка
- Платёжная интеграция (Stripe/PayPal)
- Аудит accessibility
- GDPR compliance
- Модерация контента
